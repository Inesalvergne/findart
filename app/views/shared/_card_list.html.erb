<% @artpieces.each do |artpiece| %>
  <% if artpiece.user == current_user %>
    <div class="container-card-bookings">
      <div class="container-card-top">
        <%= image_tag "dummy-painting.jpg"%>
        <div class="wrapper-booking-info">
          <p> <span> <%= artpiece.title %> </span> by <%= artpiece.artist %></p>
          <p> <i class="fa-regular fa-user"></i> Owned by <%= artpiece.user.first_name %> </p>
          <p>  Total: $<%= artpiece.price_rate %> </p>
        </div>
      </div>
      <div class="container-card-bottom">
        <p><b><%= "Incoming bookings: #{artpiece.offers.where.not(offer_confirmed: "rejected").count}" %></b></p>
        <% artpiece.offer_ids.each do |offer_id| %>
          <% offer = Offer.find(offer_id) %>
          <% user = User.find(offer.user_id) %>
          <% if offer.offer_confirmed != "rejected" %>
            <div class="container-incoming-booking">
              <div class="booking-left">
                <div class="booking-info-left">
                  <%= image_tag "https://abs.twimg.com/sticky/default_profile_images/default_profile_400x400.png" , alt: "#{artpiece.user.first_name} #{artpiece.user.last_name}" , class: "avatar" %>
                </div>
                <div class="booking-info-right">
                  <p><%= "#{user.first_name} #{user.last_name}" %></p>
                  <p><%= "Date: #{offer.start_date} to #{offer.end_date}" %></p>
                  <p><%= "Total price: $#{offer.total_price}" %></p>
                </div>
              </div>
              <div class="booking-right">
                <%= link_to "Accept Offer", accepted_offer_path(offer),  method: :patch %>
                <%= link_to "Reject Offer", rejected_offer_path(offer),  method: :patch %>
              </div>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>
  <% end %>
<% end %>
